@{
    Layout = "~/Views/Shared/_AdminTemplate.cshtml";
}

<style>
    .main-container {
        width: auto;
        margin-left: auto;
        margin-right: auto;
    }
</style>
<style>
    .grid-cell {
        width: 20px;
        height: 20px;
        border: 1px solid #aaa;
        cursor: pointer;
    }

        .grid-cell.active {
            background: #3b82f6;
        }
</style>

<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-target="#exampleModal" id="AddBlog">
    Add New Blog
</button>
<label class="BlogStatus">
    <input type="checkbox" id="switchCheckbox">
    <span class="BlogStatusSlider round"></span>
</label>

<!-- Modal -->
<div class="modal" id="AddNewBlogModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add New Blog</h5>
            </div>
            <div class="modal-body">
                <form name="BlogDetails">
                    <input type="hidden" class="form-control" id="BlogId">
                    <input type="hidden" class="form-control" id="ImageUrl">
                    <input type="hidden" class="form-control" id="BlogDetailImageUrl">
                    <div class="form-group">
                        <label for="Title">Title</label>
                        <input type="text" class="form-control" id="Title" name="title" placeholder="Title">
                    </div>
                    <div class="form-group">
                        <label for="Description">Description</label>
                        <div id="toolbar-container">
                            <span class="ql-formats">
                                <select class="ql-font"></select>
                                <select class="ql-size"></select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-bold"></button>
                                <button class="ql-italic"></button>
                                <button class="ql-underline"></button>
                                <button class="ql-strike"></button>
                            </span>
                            <span class="ql-formats">
                                <select class="ql-color"></select>
                                <select class="ql-background"></select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-script" value="sub"></button>
                                <button class="ql-script" value="super"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-header" value="1"></button>
                                <button class="ql-header" value="2"></button>
                                <button class="ql-header" value="3"></button>
                                <button class="ql-header" value="4"></button>
                                <button class="ql-header" value="5"></button>
                                <button class="ql-header" value="6"></button>
                                <button class="ql-blockquote"></button>
                                <button class="ql-code-block"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-list" value="ordered"></button>
                                <button class="ql-list" value="bullet"></button>
                                <button class="ql-indent" value="-1"></button>
                                <button class="ql-indent" value="+1"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-direction" value="rtl"></button>
                                <select class="ql-align"></select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-link"></button>
                                <button class="ql-image"></button>
                                <button class="ql-video"></button>
                                <button class="ql-formula"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-clean"></button>
                            </span>
                            <span class="ql-formats">
                                <button type="button" id="ql-view-source">Source</button>
                            </span>
                            @*<span class="ql-formats">
                                    <button class="ql-better-table"></button>
                                </span>*@


                        </div>
                        <div id="editor" style="height:250px;"></div>

                        <textarea id="html-editor"
                                  style="display:none;width:100%;height:250px;
                        font-family:Consolas,monospace;"></textarea>
                        <button type="button" id="table-btn" class="btn btn-light btn-sm mt-1" style="background-color: #bbbdbf;font-color: black !important;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-table" viewBox="0 0 16 16">
                                <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 2h-4v3h4zm0 4h-4v3h4zm0 4h-4v3h3a1 1 0 0 0 1-1zm-5 3v-3H6v3zm-5 0v-3H1v2a1 1 0 0 0 1 1zm-4-4h4V8H1zm0-4h4V4H1zm5-3v3h4V4zm4 4H6v3h4z"></path>
                            </svg>&nbsp;Table
                        </button>

                        <div id="table-popup" style="
  display:none;
  position:absolute;
  background:#fff;
  border:1px solid #ccc;
  padding:8px;
  z-index:9999;
">
                            <div id="grid" style="display:grid;grid-template-columns:repeat(10,20px);gap:2px;"></div>
                            <div id="grid-info" style="margin-top:6px;font-size:12px;">0 × 0</div>
                        </div>




                        <!-- Textarea to replace with editor -->
                        @*<div class="main-container">
                                <textarea name="Description" id="Description"></textarea>
                            </div>*@
                    </div>
                    <div class="form-group">
                        <label for="ShortTitle">Short Title</label>
                        <input type="text" class="form-control" id="ShortTitle" name="ShortTitle" placeholder="Title">
                    </div>
                    <div class="form-group">
                        <label for="BlogType">Blog Type</label>
                        <select class="form-control" id="BlogType" name="blogtype">
                            <option value=".NET Development">.NET Development</option>
                            <option value="Flutter App Development">Flutter App Development</option>
                            <option value="Artificial Intelligence">Artificial Intelligence</option>
                            <option value="UI/UX Design">UI/UX Design</option>
                            <option value="Software Development">Software Development</option>
                            <option value=".NET MAUI">.NET MAUI</option>
                            <option value="Angular Development">Angular Development</option>
                            <option value="Mobile Application Development">Mobile App Development</option>
                            <option value="Data Analytics">Data Analytics</option>
                            <option value="iOS App Development">iOS App Development</option>
                            <option value="ReactJS Development">ReactJS Development</option>
                            <option value="Web Development">Web Development</option>
                            <option value="Chatbot and Conversational AI">Chatbot and Conversational AI</option>
                            <option value="Machine Learning">Machine Learning</option>
                            <option value="React Native">React Native</option>
                            <option value="Automation Testing">Automation Testing</option>
                            <option value="Azure Development">Azure Development</option>
                            <option value="Selenium Automation Testing">Selenium Automation Testing</option>
                            <option value="ASP.NET Development">ASP.NET Development</option>
                            <option value="Cloud Development">Cloud Development</option>
                            <option value="Predictive Analytics">Predictive Analytics</option>
                            <option value="add_new" id="addNewOption">+ Add New</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="Image">Thumbnail Image</label>
                        <input id="Image" type="file" class="form-control" name="attachmentFile" />
                        <div id="preview"></div>
                    </div>
                    <div class="form-group">
                        <label for="Image">Banner Image</label>
                        <input id="BlogDetailsImage" type="file" class="form-control" name="BlogDetailsImage" />
                        <div id="BlogDetailImagepreview"></div>
                    </div>
                    <div class="form-group">
                        <label for="Date">Posting Date</label>
                        <input type="text" class="form-control" id="PostingDate" disabled>
                    </div>
                    <div class="form-group">
                        <label for="PostedBy">Posted&nbsp;By</label>

                        <select class="form-control" id="PostedBy" name="PostedBy">
                            <option value="" disabled selected>Select author</option>
                            <option>Rushil Bhuptani</option>
                            <option>Chintan Dhrangdhariya</option>
                            <option id="addPostedByOption" value="add_new">+ Add New</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="PageUrl">PageUrl</label>
                        <input type="text" class="form-control" id="PageUrl" name="PageUrl" placeholder="Page Url" />
                    </div>
                    <div class="form-group">
                        <label for="MetaTitle">Meta Title</label>
                        <input type="text" class="form-control" id="MetaTitle" name="MetaTitle" placeholder="Meta Title" />
                    </div>
                    <div class="form-group">
                        <label for="MetaDescription">Meta Description</label>
                        <textarea class="form-control" id="MetaDescription" name="MetaDescription" placeholder="Meta Description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="SchemaCode">Schema Code</label>
                        <textarea class="form-control" id="SchemaCode" name="SchemaCode" placeholder="Schema Code" rows="5"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="FaqQuestion">Add FAQ Questions</label><br />
                        <button type="button" class="btn btn-dark btn-sm" id="newrows" onclick="AddNewRows('','')"><b>Add Questions</b></button>
                        <div style="padding-top:10px;" class="table-responsive-sm">
                            <table class="table table-bordered" id="tblFaqs">
                                <thead>
                                    <tr>
                                        <th>Add Question</th>
                                        <th>Add Answer</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody class="FaqTableclass">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="ResetBlogData()">Close</button>
                        <button type="submit" class="btn btn-primary">Save as Draft</button>
                        <button type="button" onclick="SaveBlog('Published')" class="btn btn-primary">Publish</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

<div class="table-responsive pt-3">
    <table id="BlogList" class="table table-bordered table-responsive">
        <thead>
            <tr>
                <th> Title </th>
                <th> Blog Type </th>
                <th> PostingDate </th>
                <th> PostBy </th>
                <th> Status </th>
                <th></th>
                <th></th>
            </tr>
        </thead>
    </table>
</div>
@*<script>
        CKEDITOR.replace('Description', {
            height: 300,
            removeButtons: '',
            extraPlugins: 'sourcearea',
            toolbarGroups: [
                { name: 'document', groups: ['mode'] },
                { name: 'clipboard', groups: ['clipboard', 'undo'] },
                { name: 'editing', groups: ['find', 'selection'] },
                { name: 'insert' },
                { name: 'forms' },
                { name: 'tools' },
                { name: 'styles' },
                { name: 'basicstyles', groups: ['basicstyles', 'cleanup'] },
                { name: 'paragraph', groups: ['list', 'indent', 'align'] },
                { name: 'links' },
                { name: 'colors' }
            ]
        });
    </script>*@
<script>

    const sourceBtn = document.getElementById('ql-view-source');
    const htmlEditor = document.getElementById('html-editor');
    const quillEditor = document.getElementById('editor');

    let sourceMode = false;

    sourceBtn.addEventListener('click', function () {
        if (!sourceMode) {
            // Switch to HTML source
            htmlEditor.value = quill.root.innerHTML;
            quillEditor.style.display = 'none';
            htmlEditor.style.display = 'block';
            sourceBtn.innerText = 'Editor';
        } else {
            // Back to visual editor
            quill.root.innerHTML = htmlEditor.value;
            htmlEditor.style.display = 'none';
            quillEditor.style.display = 'block';
            sourceBtn.innerText = 'Source';
        }
        sourceMode = !sourceMode;
    });


</script>
@*<script>
        const tableBtn = document.getElementById('table-btn');
        const popup = document.getElementById('table-popup');
        const grid = document.getElementById('grid');
        const info = document.getElementById('grid-info');

        const MAX = 10;

        // Create grid
        for (let i = 0; i < MAX * MAX; i++) {
            const cell = document.createElement('div');
            cell.className = 'grid-cell';
            grid.appendChild(cell);
        }

        // Show popup near button
        tableBtn.onclick = (e) => {
            popup.style.display = 'block';
            popup.style.top = (e.target.offsetTop + 30) + 'px';
            popup.style.left = e.target.offsetLeft + 'px';
        };

        let rows = 0, cols = 0;

        grid.addEventListener('mouseover', e => {
            if (!e.target.classList.contains('grid-cell')) return;

            const index = [...grid.children].indexOf(e.target);
            rows = Math.floor(index / MAX) + 1;
            cols = (index % MAX) + 1;

            info.innerText = `${rows} × ${cols}`;

            [...grid.children].forEach((c, i) => {
                c.classList.toggle(
                    'active',
                    Math.floor(i / MAX) < rows && (i % MAX) < cols
                );
            });
        });

        // Insert table on click
        grid.addEventListener('click', () => {
            let html = `<table border="1" style="border-collapse:collapse;width:100%">`;
            for (let r = 0; r < rows; r++) {
                html += '<tr>';
                for (let c = 0; c < cols; c++) {
                    html += '<td>&nbsp;</td>';
                }
                html += '</tr>';
            }
            html += '</table><p><br></p>';

            quill.clipboard.dangerouslyPasteHTML(
                quill.getSelection()?.index || 0,
                html
            );

            popup.style.display = 'none';
        });

    </script>*@
<script>
    /* =======================
       QUILL INITIALIZATION
    ======================== */
    //const quill = new Quill('#editor', {
    //    theme: 'snow',
    //    modules: {
    //        toolbar: [
    //            ['bold', 'italic', 'underline'],
    //            [{ list: 'ordered' }, { list: 'bullet' }],
    //            ['code-block'],
    //            ['clean']
    //        ]
    //    }
    //});


</script>

<script type="text/javascript">

    ////// init quill editor.
    //const Icons = Quill.import('ui/icons');

    //// Custom H3 to H6 icons register
    //['3', '4', '5', '6'].forEach(level => {
    //    Icons.header[level] = `
    //  <svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
    //    <text x="2" y="13" font-size="11" font-family="sans-serif" font-weight="700">H${level}</text>
    //  </svg>`;
    //});
    //const quill = new Quill('#editor', {
    //    modules: {
    //        syntax: true,
    //        toolbar: '#toolbar-container',
    //    },
    //    placeholder: 'Compose an epic...',
    //    theme: 'snow',
    //});



    const Icons = Quill.import('ui/icons');

    // Custom H3 to H6 icons register
    ['3', '4', '5', '6'].forEach(level => {
        Icons.header[level] = `
    <svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
      <text x="2" y="13" font-size="11" font-family="sans-serif" font-weight="700">H${level}</text>
    </svg>`;
    });
    const quill = new Quill('#editor', {
        modules: {
            syntax: true,
            toolbar: '#toolbar-container',
        },
        placeholder: 'Compose an epic...',
        theme: 'snow',
    });

    /* =======================
       HTML SOURCE TOGGLE
    ======================== */
    //const toggleBtn = document.getElementById('toggleBtn');
    //const editorDiv = document.getElementById('editor');
    //const sourceEditor = document.getElementById('sourceEditor');
    ///*let sourceMode = false;*/

    //toggleBtn.addEventListener('click', () => {
    //    if (!sourceMode) {
    //        sourceEditor.value = quill.root.innerHTML;
    //        editorDiv.style.display = 'none';
    //        sourceEditor.style.display = 'block';
    //        toggleBtn.innerText = 'Back to Editor';
    //    } else {
    //        const range = quill.getSelection(true);
    //        const index = range ? range.index : quill.getLength();

    //        quill.clipboard.dangerouslyPasteHTML(index, sourceEditor.value, 'user');
    //        quill.setSelection(index + 1);

    //        sourceEditor.style.display = 'none';
    //        editorDiv.style.display = 'block';
    //        toggleBtn.innerText = 'View HTML';
    //    }
    //    sourceMode = !sourceMode;
    //});

    /* =======================
       TABLE GRID LOGIC
    ======================== */
    const tableBtn = document.getElementById('table-btn');
    const popup = document.getElementById('table-popup');
    const grid = document.getElementById('grid');
    const info = document.getElementById('grid-info');

    const MAX = 10;
    let rows = 0, cols = 0;

    // Create grid
    for (let i = 0; i < MAX * MAX; i++) {
        const cell = document.createElement('div');
        cell.className = 'grid-cell';
        grid.appendChild(cell);
    }

    // Show popup near button
    tableBtn.onclick = (e) => {
        popup.style.display = 'block';
        popup.style.top = (e.target.offsetTop + 30) + 'px';
        popup.style.left = e.target.offsetLeft + 'px';
    };

    // Highlight grid on hover
    grid.addEventListener('mouseover', (e) => {
        if (!e.target.classList.contains('grid-cell')) return;

        const index = [...grid.children].indexOf(e.target);
        rows = Math.floor(index / MAX) + 1;
        cols = (index % MAX) + 1;

        info.innerText = `${rows} × ${cols}`;

        [...grid.children].forEach((c, i) => {
            c.classList.toggle(
                'active',
                Math.floor(i / MAX) < rows && (i % MAX) < cols
            );
        });
    });

    // INSERT TABLE AT CURSOR
    grid.addEventListener('click', () => {
        const range = quill.getSelection(true);
        const index = range ? range.index : quill.getLength();

        let html = `<table border="1" style="border-collapse:collapse;width:100%">`;
        for (let r = 0; r < rows; r++) {
            html += '<tr>';
            for (let c = 0; c < cols; c++) {
                html += '<td>&nbsp;</td>';
            }
            html += '</tr>';
        }
        html += '</table><p><br></p>';

        quill.clipboard.dangerouslyPasteHTML(index, html, 'user');
        quill.setSelection(index + 1);

        popup.style.display = 'none';
    });


    $.validator.addMethod("filesize", function (value, element, param) {

        // if no file selected → valid
        if (element.files.length === 0) {
            return true;
        }

        return element.files[0].size <= param;

    }, "Image size must be less than or equal to 2 MB");

                                var validator;
                                $(function () {
                                     validator = $("form[name='BlogDetails']").validate({
                                        rules: {
                                            title: { required: true, },
                                            description: { required: true, },
                                            ShortTitle: {
                                                required: true,
                                                maxlength: 30,
                                            },
                                            blogtype: { required: true, },
                                            attachmentFile: {
                                                 required: true,
                                                 filesize: 2 * 1024 * 1024 // 2 MB
                                             },
                                             BlogDetailsImage: {
                                                 filesize: 2 * 1024 * 1024 // 2 MB
                                             },
                                            PostedBy: { required: true, },
                                            PageUrl: { required: true },
                                            MetaTitle: { required: true },
                                            MetaDescription: { required: true }
                                            //SchemaCode: {required:true}
                                        },
                                        messages: {
                                            title: { required: "Please enter a title", },
                                            description: { required: "Please enter description", },
                                            ShortTitle: {
                                                required: "Please enter short title",
                                                maxlength: "Title must be less than 30 characters..",
                                            },
                                            blogtype: { required: "Please enter blogtype", },
                                            attachmentFile: {
                                                required: "Please choose a file",
                                                filesize: "Image size must be less than or equal to 2 MB"
                                            },
                                            BlogDetailsImage: {
                                                filesize: "Image size must be less than or equal to 2 MB"
                                            },
                                            PostedBy: { required: "Please enter PostedBy", },
                                            PageUrl: { required: "Please enter Url", },
                                            MetaTitle: { required: "Please enter Meta Title", },
                                            MetaDescription: { required: "Please enter Meta Description", }
                                            //SchemaCode: { required: "Please enter Schema Code", }
                                        },
                                        submitHandler: function (form) {
                                            SaveBlog('Draft')
                                        }
                                    });

                                    //var Postingdate = new Date();
                                    //var FormatPostingDate = moment(Postingdate).format('MM/DD/YYYY HH:mm:ss');
                                    //var FormatPostingDate = (new Date()).toISOString().split('T')[0];
                                    //$("#PostingDate").val(FormatPostingDate);

                                    GetBlogStatusByName();
                                    GetBlogList();
                                });
                                    
                                $('#AddBlog').click(function () {
                                    var Postingdate = new Date();
                                    var FormatPostingDate = moment(Postingdate).format('MM/DD/YYYY HH:mm:ss');
                                    //var FormatPostingDate = (new Date()).toISOString().split('T')[0];
                                    $("#PostingDate").val(FormatPostingDate);
                                    $("#AddNewBlogModal").modal('show');
                                });

                                function SaveBlog(Status) {
                                    showSpinner();
                                    var Blogs = new Array();
                                    $("#tblFaqs tbody tr").each(function () {
                                        var row = $(this);
                                        var Blog = {};
                                        Blog.Questions = row.find(".clsfaqQuestion").val();
                                        Blog.Answers = row.find(".clsfaqAnswers").val();
                                        Blogs.push(Blog);
                                    });

                                    var Id = $("#BlogId").val();
                                    var Title = $("#Title").val();
                                    var ShortTitle = $('#ShortTitle').val();
                                    //var Description = CKEDITOR.instances['Description'].getData();
                                    var Description = quill.root.innerHTML;
                                    var BlogType = $("#BlogType").val();
                                    var PostingDate = $("#PostingDate").val();
                                    var Resume = $("#Image").get(0);
                                    var files = Resume.files;

                                    var BlogDetailImage = $("#BlogDetailsImage").get(0);
                                    var BlogFile = BlogDetailImage.files;

                                    var PostedBy = $("#PostedBy").val();
                                    var ImageUrl = $("#ImageUrl").val();
                                    var PageUrl = $("#PageUrl").val();
                                    var MetaTitle = $("#MetaTitle").val();
                                    var MetaDescription = $("#MetaDescription").val();
                                    var SchemaCode = $("#SchemaCode").val();
                                    var BlogDetailUrl = $("#BlogDetailImageUrl").val();

                                    var fileData = new FormData();
                                    fileData.append("Id",Id);
                                    fileData.append("Image", files[0]);
                                    fileData.append('Description', Description);
                                    fileData.append('ShortTitle', ShortTitle);
                                    fileData.append('BlogType', BlogType);
                                    fileData.append('PostingDate', PostingDate);
                                    fileData.append('PostedBy', PostedBy);
                                    fileData.append('Title', Title);
                                    fileData.append('ImageUrl', ImageUrl);
                                    fileData.append('BlogDetailImage', BlogFile[0]);
                                    fileData.append('PageUrl', PageUrl);
                                    fileData.append('MetaTitle', MetaTitle);
                                    fileData.append('MetaDescription', MetaDescription);
                                    fileData.append('SchemaCode', SchemaCode);
                                    fileData.append('BlogDetailImageUrl', BlogDetailUrl);
                                    fileData.append('BlogFaqs', JSON.stringify(Blogs));
                                    fileData.append('Status', Status);

                                    $.ajax({
                                        type: "POST",
                                        url: "/api/Admin/SaveBlog",
                                        data: fileData,
                                        cache: false,
                                        contentType: false,
                                        processData: false,
                                        success: function (result) {
                                            hideSpinner();
                                            if (result == "success") {
                                                alert("success");
                                                GetBlogList();
                                                ResetBlogData();
                                                $("#AddNewBlogModal").modal('hide');
                                            } else {
                                                alert("Some Error..")
                                            }

                                        },
                                        error: function (result) {
                                            hideSpinner()
                                            alert(result.responseText);
                                        }
                                    });
                                }

                                function GetBlogList() {
                                    $.ajax({
                                        type: "Get",
                                         url: "@Url.Action("GetBlogList", "BlogVacancy")",
                                        success: function (result) {
                                            $('#BlogList').dataTable({
                                                destroy: true,
                                                data: result,
                                                "columns": [
                                                    {
                                                        "data": "Title",
                                                        "render": function (data, type, row) {
                                                            var reviewName = data.length > 35 ? data.substring(0, 35) + "..." : data;
                                                            return "<span title='" + data + "'>" + reviewName + "</span>";
                                                        }
                                                    },
                                                    {"data": "BlogType"},
                                                    {
                                                        "data": "PostingDate",
                                                        "render": function (data) {
                                                            const dateValue = new Date(parseInt(data.substr(6)));
                                                            return moment(dateValue).format('DD/MM/YYYY HH:mm');
                                                        }
                                                    },
                                                    { "data": "PostedBy" },
                                                    { "data": "Status" },
                                                    {
                                                        "data": "Id",
                                                        "render": function (data, type, row) {
                                                            return '<a class="btn btn-info btn-sm" style="color: white;" onclick="GetBlogDetailsById(' + data + ')"><i class="mdi mdi-pencil"></i></a>';
                                                        }
                                                    },
                                                    {
                                                        "data": "Id",
                                                        "render": function (data, type, row) {
                                                            return '<a class="btn btn-danger btn-sm" style="color: white;" onclick=DeleteBlog(' +data +')><i class="mdi mdi-delete"></i></a>';
                                                        }
                                                    }
                                                ],
                                                ordering: false
                                            });


                                        },
                                        error: function (result) {
                                            alert(result.responseText);
                                        }
                                    });
                                }

                                function DeleteBlog(id) {
                                    if (confirm('Are you sure want to delete Blog?')) {
                                        $.ajax({
                                            url: '@Url.Action("DeleteBlog", "BlogVacancy")',
                                            contentType: 'application/json',
                                            data: { Id: id },
                                            type: "GET",
                                            success: function (result) {
                                                GetBlogList();
                                                alert('Delete Successully!');

                                            },
                                            error: function (result) {
                                                alert(result.responseText);
                                            }
                                        });
                                    }
                                    else {
                                        return;
                                    }
                                }

                                function GetBlogDetailsById(id) {
                                    $("#AddNewBlogModal").modal('show');
                                    $.ajax({
                                        url: '@Url.Action("GetBlogById", "BlogVacancy")',
                                        contentType: 'application/json',
                                        data: { Id: id },
                                        type: "GET",
                                        success: function (result) {
                                            $("#BlogId").val(result.bloglist[0].Id);
                                            $("#Title").val(result.bloglist[0].Title);
                                            //CKEDITOR.instances['Description'].setData(result.bloglist[0].Description);
                                            quill.root.innerHTML = result.bloglist[0].Description;

                                            $("#ShortTitle").val(result.bloglist[0].ShortTitle);
                                            $("#BlogType").val(result.bloglist[0].BlogType);
                                            loadURLToInputFiled(result.bloglist[0].ImageName);
                                            $("#preview").find("span").first().remove();
                                            $('#preview').show();
                                            var span = document.createElement('span');
                                            span.innerHTML =
                                                ['<img class="thumb" src="', result.bloglist[0].Image, '"/><span class="remove_img_preview"></span>']
                                                    .join('');
                                            document.getElementById('preview').insertBefore(span, null);
                                            var date = moment(result.bloglist[0].PostingDate).format('MM/DD/YYYY HH:mm:ss');
                                            $("#PostingDate").val(date);
                                            $("#PostedBy").val(result.bloglist[0].PostedBy);
                                            $("#ImageUrl").val(result.bloglist[0].Image);
                                            $("#PageUrl").val(result.bloglist[0].PageUrl);
                                            $("#BlogDetailImageUrl").val(result.bloglist[0].BlogDetailImage);
                                            $("#MetaTitle").val(result.bloglist[0].MetaTitle);
                                            $("#MetaDescription").val(result.bloglist[0].MetaDescription);
                                            $("#SchemaCode").val(result.bloglist[0].SchemaCode);
                                            $("#BlogDetailImagepreview").find("span").first().remove();
                                            $('#BlogDetailImagepreview').show();
                                            var span = document.createElement('span');
                                            span.innerHTML =
                                                ['<img class="BlogImage" src="', result.bloglist[0].BlogDetailImage, '"/><span class="remove_BlogDetailimg_preview"></span>']
                                                    .join('');
                                            document.getElementById('BlogDetailImagepreview').insertBefore(span, null);
                                            addNameToFile(result.bloglist[0].BlogDetailImageName);

                                            $.each(result.blogfaqslist, function (key, val) {
                                                AddNewRows(val.Questions, val.Answers);
                                            });
                                        },
                                        error: function (result) {
                                            alert(result.responseText);
                                        }
                                    });
                                }


                                function loadURLToInputFiled(url) {
                                    getImgURL(url, (imgBlob) => {
                                        let file = new File([imgBlob], url, { type: "image/jpeg", lastModified: new Date().getTime() }, 'utf-8');
                                        let container = new DataTransfer();
                                        container.items.add(file);
                                        document.querySelector('#Image').files = container.files;
                                    })
                                }

                                function addNameToFile(url) {
                                    getImgURL(url, (imgBlob) => {
                                        let file = new File([imgBlob], url, { type: "image/jpeg", lastModified: new Date().getTime() }, 'utf-8');
                                        let container = new DataTransfer();
                                        container.items.add(file);
                                        document.querySelector('#BlogDetailsImage').files = container.files;
                                    })
                                }

                                function getImgURL(url, callback) {
                                    var xhr = new XMLHttpRequest();
                                    xhr.onload = function () {
                                        callback(xhr.response);
                                    };
                                    xhr.open('GET', url);
                                    xhr.responseType = 'blob';
                                    xhr.send();
                                }

                                function ResetBlogData() {
                                    validator.resetForm();
                                    $("#AddNewBlogModal").modal('hide');
                                    $("#BlogId").val('');
                                    $("#ShortTitle").val('');
                                    $("#Title").val('');
                                    quill.setText();
                                    //CKEDITOR.instances.Description.setData('');
                                    $("#BlogType").val('');
                                    $("#PostingDate").val('');
                                    $(".thumb").attr('src', '');
                                    $('#preview').hide();
                                    $("#Image").val('');
                                    $("#BlogDetailsImage").val('');
                                    $("#PostedBy").val('');
                                    $("#ImageUrl").val('');
                                    $("#PageUrl").val('');
                                    $("#tblFaqs .FaqTableclass").html("");
                                    $("#MetaDescription").val("");
                                    $("#MetaTitle").val("");
                                    $(".BlogImage").attr('src', '');
                                    $("#BlogDetailImagepreview").hide()
                                    $("#BlogDetailImageUrl").val("");
                                    $("#SchemaCode").val("");
                                    console.clear();
                                }

                                function handleFileSelect(event) {
                                    console.log(event)
                                    $("#ImageUrl").val('');
                                    var input = this;
                                    if (input.files && input.files[0]) {
                                        var reader = new FileReader();
                                        console.log(reader)
                                        reader.onload = (function (e) {
                                            $("#preview").find("span").first().remove();
                                            $('#preview').show();
                                            var span = document.createElement('span');
                                            span.innerHTML =
                                                ['<img class="thumb" src="', e.target.result, '" title="', escape(e.name), '"/><span class="remove_img_preview"></span>']
                                                    .join('');
                                            document.getElementById('preview').insertBefore(span, null);
                                        });

                                        reader.readAsDataURL(input.files[0]);
                                    }
                                }

                                $('#Image').change(handleFileSelect);
                                $('#preview').on('click', '.remove_img_preview', function () {
                                    $(this).parent('span').remove();
                                    $(this).val("");
                                    $("#Image").val("");
                                });
                                $('.BlogStatus input[type="checkbox"]').on('change', function () {
                                    var status = $("#switchCheckbox").is(':checked');
                                    var menu = {
                                        MenuName: "blog",
                                        Status: status
                                    }
                                    $.ajax({
                                        type: "POST",
                                            url: '@Url.Action("BlogStatus", "BlogVacancy")',
                                         contentType: 'application/json',
                                         data: JSON.stringify(menu),
                                            success: function (result) {
                                                alert('Status Update Successully!');

                                            },
                                            error: function () {
                                                alert(result.responseText);
                                            }
                                        });
                                });
                                function GetBlogStatusByName() {
                                     $.ajax({
                                        url: '@Url.Action("GetBlogStatusByName", "BlogVacancy")',
                                        contentType: 'application/json',
                                         data: { name: "blog" },
                                        type: "GET",
                                         success: function (result) {
                                            if (result != null) {
                                                if (result.Status) {
                                                    $("#switchCheckbox").prop("checked", true);
                                                }
                                            }

                                        },
                                        error: function (result) {
                                            alert(result.responseText);
                                        }
                                    });
                                }

                                var count = 1;
                                function AddNewRows(Questions,Answers) {
                                    var addcontrols = '<tr id="RowId_' +count+ '>" + count + ">'
                                    addcontrols += '<td><textarea type="text" class="form-control clsfaqQuestion" name="faqTitle" placeholder="Add question">' + Questions +'</textarea></td>'
                                    addcontrols += '<td><textarea type="text" class="form-control clsfaqAnswers" name="faqTitle" placeholder="Add answer"/>'+Answers+'</textarea></td>'
                                    addcontrols += "<td><input type='button' id='btnDelete' class='btn btn-danger btn-sm deleteFaqquestion' Value='Delete'></td>"
                                    addcontrols += "</tr>";
                                    count++;
                                    $("table .FaqTableclass").append(addcontrols);
                                }
                                $("table .FaqTableclass").on('click', '.deleteFaqquestion', function () {
                                    $(this).closest('tr').remove();
                                });


                                $("#BlogDetailsImage").change(AddBogDetailImage);
                                function AddBogDetailImage(event) {
                                    $("#BlogDetailImageUrl").val("");
                                    var input = this;
                                    if (input.files && input.files[0]) {
                                        var reader = new FileReader();
                                        console.log(reader)
                                        reader.onload = (function (e) {
                                            $("#BlogDetailImagepreview").find("span").first().remove();
                                            $('#BlogDetailImagepreview').show();
                                            var span = document.createElement('span');
                                            span.innerHTML =
                                                ['<img class="BlogImage" src="', e.target.result, '" title="', escape(e.name), '"/><span class="remove_BlogDetailimg_preview"></span>']
                                                    .join('');
                                            document.getElementById('BlogDetailImagepreview').insertBefore(span, null);
                                        });

                                        reader.readAsDataURL(input.files[0]);
                                    }
                                }
                                $('#BlogDetailImagepreview').on('click', '.remove_BlogDetailimg_preview', function () {
                                    $(this).parent('span').remove();
                                    $(this).val("");
                                    $("#BlogDetailsImage").val("");
                                });
                                // -------- Add‑New Category --------
                                $('#BlogType').on('change', function () {
                                    if (this.value === 'add_new') {
                                        const newCat = prompt('Enter new category name:');
                                        if (newCat && newCat.trim() !== '') {

                                            // duplicate तो नहीं?
                                            const exists = Array.from(this.options)
                                                .some(o => o.value.toLowerCase() === newCat.toLowerCase());

                                            if (!exists) {
                                                const opt = document.createElement('option');
                                                opt.value = newCat.trim();
                                                opt.textContent = newCat.trim();
                                                // "Add New…" से पहले घुसाएँ
                                                this.insertBefore(opt, document.getElementById('addNewOption'));
                                            }
                                            // नया या पहले‑से‑मौजूद—उसे select कर दें
                                            this.value = newCat.trim();
                                        } else {
                                            // कुछ नहीं टाइप हुआ—dropdown रिसेट
                                            this.value = '';
                                        }
                                    }
                                });
                                // -------- Add‑New "Posted By" --------
                                $('#PostedBy').on('change', function () {
                                    if (this.value === 'add_new') {

                                        const newName = prompt('Enter author name:').trim();

                                        if (newName) {

                                            // already there?
                                            const exists = Array.from(this.options)
                                                .some(o => o.value.toLowerCase() === newName.toLowerCase());

                                            if (!exists) {
                                                // insert just before the +Add‑new option
                                                const opt = document.createElement('option');
                                                opt.value = newName;
                                                opt.textContent = newName;
                                                this.insertBefore(opt, document.getElementById('addPostedByOption'));
                                            }
                                            // make the new / existing item selected
                                            this.value = newName;
                                        } else {
                                            // nothing typed → reset dropdown
                                            this.value = '';
                                        }
                                    }
                                });




</script>
